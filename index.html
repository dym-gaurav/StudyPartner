<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduTrack - Learning Progress Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #121212;
            color: #f0f0f0;
            min-height: 100vh;
            padding: 0;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Page */
        #login-page {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
            padding: 20px;
        }

        .logo {
            margin-bottom: 40px;
            text-align: center;
        }

        .logo h1 {
            color: #f0f0f0;
            font-size: 3rem;
            margin-bottom: 10px;
            font-weight: 700;
            background: linear-gradient(90deg, #6b5ce7, #ff7aa2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo p {
            color: #aaa;
            font-size: 1.2rem;
        }

        .login-form {
            background: #252525;
            padding: 30px;
            border-radius: 15px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #ddd;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            background: #333;
            color: #fff;
            border: 1px solid #444;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .input-group input:focus {
            border-color: #6b5ce7;
            outline: none;
            box-shadow: 0 0 0 2px rgba(107, 92, 231, 0.2);
        }

        button {
            background: linear-gradient(90deg, #6b5ce7, #ff7aa2);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            width: 100%;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(107, 92, 231, 0.4);
        }

        .error-message {
            color: #ff5555;
            margin-top: 15px;
            display: none;
            text-align: center;
        }

        /* Dashboard */
        #dashboard {
            display: none;
        }

        .header {
            padding: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
        }

        .user-dp {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #444;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .user-dp img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-details {
            flex: 1;
        }

        .user-details h2 {
            color: #f0f0f0;
            margin-bottom: 5px;
            font-size: 1.5rem;
        }

        .user-progress-summary {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .progress-label {
            font-size: 0.9rem;
            color: #aaa;
            min-width: 80px;
        }

        .mini-progress-bar {
            flex: 1;
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
        }

        .mini-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6b5ce7, #ff7aa2);
            border-radius: 4px;
            width: 0%;
        }

        .progress-percent {
            font-size: 0.9rem;
            color: #ddd;
            min-width: 40px;
            text-align: right;
        }

        /* Mode Selector */
        .mode-selector {
            margin: 0 15px;
        }

        .mode-selector select {
            background: #333;
            color: #fff;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 14px;
            cursor: pointer;
        }

        .logout-btn {
            background: none;
            border: none;
            color: #aaa;
            cursor: pointer;
            padding: 10px;
            width: auto;
            font-size: 24px;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            color: #ff7aa2;
            background: none;
            transform: scale(1.1);
        }

        /* Progress Section */
        .progress-section {
            margin-bottom: 40px;
            background: #1e1e1e;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
        }

        .progress-section h3 {
            color: #f0f0f0;
            margin-bottom: 25px;
            font-size: 1.5rem;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }

        .progress-container {
            background: #252525;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .progress-title {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            color: #ddd;
            font-weight: 500;
        }

        .progress-bar {
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6b5ce7, #ff7aa2);
            border-radius: 10px;
            width: 0%;
            transition: width 1s ease-in-out;
        }

        /* User Comparison Section */
        .comparison-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 40px;
        }

        .user-comparison-card {
            background: #1e1e1e;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
        }

        .user-comparison-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .comparison-user-dp {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid #444;
        }

        .comparison-user-dp img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .comparison-user-details h4 {
            color: #f0f0f0;
            margin-bottom: 5px;
            font-size: 1.2rem;
        }

        .comparison-progress-summary {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
        }

        /* Subjects Container */
        .subjects-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .subject-card {
            background: #252525;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
            transition: transform 0.3s;
        }

        .subject-card:hover {
            transform: translateY(-5px);
        }

        .subject-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }

        .subject-header h4 {
            color: #f0f0f0;
            font-size: 1.2rem;
        }

        .subject-progress {
            height: 10px;
            background: #333;
            border-radius: 5px;
            margin: 10px 0 20px;
            overflow: hidden;
        }

        .subject-progress-fill {
            height: 100%;
            border-radius: 5px;
            width: 0%;
            transition: width 1s ease-in-out;
        }

        .chemistry .subject-progress-fill {
            background: linear-gradient(90deg, #6b5ce7, #3498db);
        }

        .physics .subject-progress-fill {
            background: linear-gradient(90deg, #ff7aa2, #ff5252);
        }

        .maths .subject-progress-fill {
            background: linear-gradient(90deg, #fbc531, #e84118);
        }

        .chapters-list {
            list-style: none;
            margin-top: 15px;
        }

        .chapter-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #333;
        }

        .chapter-item:last-child {
            border-bottom: none;
        }

        .chapter-item label {
            flex-grow: 1;
            margin-right: 10px;
            color: #ddd;
        }

        /* Circular Checkbox Styling */
        .chapter-item input[type="checkbox"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid #666;
            background-color: #333;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
        }

        .chapter-item input[type="checkbox"]:checked {
            background: linear-gradient(90deg, #6b5ce7, #ff7aa2);
            border-color: #6b5ce7;
        }

        .chapter-item input[type="checkbox"]:checked::after {
            content: "âœ“";
            position: absolute;
            color: white;
            font-size: 14px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .add-chapter {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .add-chapter input {
            flex: 1;
            padding: 10px;
            background: #333;
            color: #fff;
            border: 1px solid #444;
            border-radius: 5px;
        }

        .add-chapter button {
            width: auto;
            padding: 10px 15px;
            font-size: 14px;
        }

        /* Study Timer Section */
        .study-timer-section {
            background: #1e1e1e;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
            margin-bottom: 40px;
            text-align: center;
        }

        .timer-display {
            font-size: 4rem;
            font-weight: 700;
            margin: 20px 0;
            color: #f0f0f0;
            font-family: 'Courier New', monospace;
            background: #252525;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #333;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .timer-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: auto;
        }

        .start-btn {
            background: linear-gradient(90deg, #00b09b, #96c93d);
        }

        .pause-btn {
            background: linear-gradient(90deg, #ff7e5f, #feb47b);
        }

        .reset-btn {
            background: linear-gradient(90deg, #ff5e62, #ff9966);
        }

        .timer-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .timer-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .timer-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }

        .stat-box {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #6b5ce7;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #aaa;
            font-size: 0.9rem;
        }

        /* Weekly Study Graph Section */
        .study-graph-section {
            background: #1e1e1e;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
            margin-bottom: 40px;
        }

        .study-graph-section h3 {
            color: #f0f0f0;
            margin-bottom: 25px;
            font-size: 1.5rem;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }

        .graph-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .graph-controls button {
            background: #333;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            width: auto;
            padding: 10px;
        }

        .graph-controls button:hover {
            background: #6b5ce7;
        }

        #week-display {
            color: #ddd;
            font-weight: 500;
            min-width: 180px;
            text-align: center;
        }

        .graph-container {
            height: 300px;
            background: #252525;
            border-radius: 10px;
            padding: 15px;
        }

        @media (max-width: 900px) {
            .comparison-section {
                grid-template-columns: 1fr;
            }
            
            .subjects-container {
                grid-template-columns: 1fr;
            }
            
            .timer-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .timer-btn {
                width: 100%;
                max-width: 250px;
            }
            
            .timer-stats {
                flex-direction: column;
                gap: 20px;
            }
        }

        @media (max-width: 700px) {
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .user-info {
                flex-direction: column;
                text-align: center;
            }
            
            .user-progress-summary {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="login-page">
        <div class="logo">
            <h1>EduTrack</h1>
            <p>Track your learning progress and achieve your goals</p>
        </div>
        <div class="login-form">
            <div class="input-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Enter your username">
            </div>
            <div class="input-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter your password">
            </div>
            <button id="login-btn">Login</button>
            <div class="error-message" id="login-error">Invalid username or password</div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard">
        <div class="container">
            <div class="header">
                <div class="user-info">
                    <div class="user-dp">
                        <img id="user-avatar" src="https://via.placeholder.com/80" alt="User Avatar">
                    </div>
                    <div class="user-details">
                        <h2 id="user-name">User Name</h2>
                        <div class="user-progress-summary">
                            <span class="progress-label">Overall Progress</span>
                            <div class="mini-progress-bar">
                                <div class="mini-progress-fill" id="overall-progress"></div>
                            </div>
                            <span class="progress-percent" id="overall-percent">0%</span>
                        </div>
                    </div>
                </div>
                
                <div class="mode-selector">
                    <select id="board-select">
                        <option value="cbse">CBSE</option>
                        <option value="icse">ICSE</option>
                        <option value="state">State Board</option>
                    </select>
                </div>
                
                <button class="logout-btn" id="logout-btn" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>

            <div class="progress-section">
                <h3>Your Progress Overview</h3>
                <div class="progress-container">
                    <div class="progress-title">
                        <span>Chemistry</span>
                        <span id="chemistry-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="chemistry-progress"></div>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-title">
                        <span>Physics</span>
                        <span id="physics-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="physics-progress"></div>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-title">
                        <span>Mathematics</span>
                        <span id="maths-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="maths-progress"></div>
                    </div>
                </div>
            </div>

            <div class="study-timer-section">
                <h3>Study Timer</h3>
                <div class="timer-display" id="timer">00:00:00</div>
                <div class="timer-controls">
                    <button class="timer-btn start-btn" id="start-btn">Start</button>
                    <button class="timer-btn pause-btn" id="pause-btn" disabled>Pause</button>
                    <button class="timer-btn reset-btn" id="reset-btn" disabled>Reset</button>
                </div>
                <div class="timer-stats">
                    <div class="stat-box">
                        <div class="stat-value" id="today-time">0h 0m</div>
                        <div class="stat-label">Today</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="week-time">0h 0m</div>
                        <div class="stat-label">This Week</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="total-time">0h 0m</div>
                        <div class="stat-label">Total</div>
                    </div>
                </div>
            </div>

            <div class="subjects-container" id="subjects-container">
                <!-- Subject cards will be generated here -->
            </div>

            <div class="study-graph-section">
                <h3>Weekly Study Time</h3>
                <div class="graph-controls">
                    <button id="prev-week"><i class="fas fa-chevron-left"></i> Previous</button>
                    <span id="week-display">Week 1, Jan 2023</span>
                    <button id="next-week">Next <i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="graph-container">
                    <canvas id="study-chart"></canvas>
                </div>
            </div>

            <div class="comparison-section">
                <div class="user-comparison-card">
                    <div class="user-comparison-header">
                        <div class="comparison-user-dp">
                            <img src="https://via.placeholder.com/60" alt="User 1">
                        </div>
                        <div class="comparison-user-details">
                            <h4>sounak</h4>
                            <div class="comparison-progress-summary">
                                <span class="progress-label">Progress</span>
                                <div class="mini-progress-bar">
                                    <div class="mini-progress-fill" id="comparison-progress-1"></div>
                                </div>
                                <span class="progress-percent" id="comparison-percent-1">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-title">
                            <span>Chemistry</span>
                            <span id="comparison-chemistry-1">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="comparison-chemistry-bar-1"></div>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-title">
                            <span>Physics</span>
                            <span id="comparison-physics-1">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="comparison-physics-bar-1"></div>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-title">
                            <span>Mathematics</span>
                            <span id="comparison-maths-1">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="comparison-maths-bar-1"></div>
                        </div>
                    </div>
                </div>

                <div class="user-comparison-card">
                    <div class="user-comparison-header">
                        <div class="comparison-user-dp">
                            <img src="https://via.placeholder.com/60" alt="User 2">
                        </div>
                        <div class="comparison-user-details">
                            <h4>gaurav</h4>
                            <div class="comparison-progress-summary">
                                <span class="progress-label">Progress</span>
                                <div class="mini-progress-bar">
                                    <div class="mini-progress-fill" id="comparison-progress-2"></div>
                                </div>
                                <span class="progress-percent" id="comparison-percent-2">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-title">
                            <span>Chemistry</span>
                            <span id="comparison-chemistry-2">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="comparison-chemistry-bar-2"></div>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-title">
                            <span>Physics</span>
                            <span id="comparison-physics-2">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="comparison-physics-bar-2"></div>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-title">
                            <span>Mathematics</span>
                            <span id="comparison-maths-2">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="comparison-maths-bar-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_KEY = '$2a$10$ZZmri.xNpvu4cY6Iwt1z0ORO.UqK6oYspAWWzBVC0.zEBxRF3FAay';
        const USER_BIN_ID = '68c568a1ae596e708fed72a8';
        const USER_BINS = {
            'sounak': '68c56c6bae596e708fed7603',
            'gaurav': '68c56c99d0ea881f407ca553'
        };

        // Global variables
        let currentUser = null;
        let userData = null;
        let studyTimer = {
            startTime: null,
            elapsed: 0,
            isRunning: false,
            interval: null
        };
        let currentWeekOffset = 0;
        let studyChart = null;

        // DOM Elements
        const loginPage = document.getElementById('login-page');
        const dashboard = document.getElementById('dashboard');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginError = document.getElementById('login-error');
        const subjectsContainer = document.getElementById('subjects-container');
        const timerDisplay = document.getElementById('timer');
        const startBtn = document.getElementById('start-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const todayTime = document.getElementById('today-time');
        const weekTime = document.getElementById('week-time');
        const totalTime = document.getElementById('total-time');
        const prevWeekBtn = document.getElementById('prev-week');
        const nextWeekBtn = document.getElementById('next-week');
        const weekDisplay = document.getElementById('week-display');

        // Initialize the application
        function init() {
            // Check if user is already logged in (from localStorage)
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    const user = JSON.parse(savedUser);
                    loginUser(user);
                } catch (e) {
                    localStorage.removeItem('currentUser');
                }
            }

            // Event listeners
            loginBtn.addEventListener('click', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            startBtn.addEventListener('click', startTimer);
            pauseBtn.addEventListener('click', pauseTimer);
            resetBtn.addEventListener('click', resetTimer);
            prevWeekBtn.addEventListener('click', () => changeWeek(-1));
            nextWeekBtn.addEventListener('click', () => changeWeek(1));
            
            // Enter key to login
            passwordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });
        }

        // Handle login process
        async function handleLogin() {
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();

            if (!username || !password) {
                showError('Please enter both username and password');
                return;
            }

            try {
                // Fetch user data from JSONBin
                const users = await fetchUsers();
                const user = users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    loginUser(user);
                } else {
                    showError('Invalid username or password');
                }
            } catch (error) {
                console.error('Login error:', error);
                showError('Failed to login. Please try again.');
            }
        }

        // Fetch users from JSONBin
        async function fetchUsers() {
            const response = await fetch(`https://api.jsonbin.io/v3/b/${USER_BIN_ID}/latest`, {
                headers: {
                    'X-Access-Key': API_KEY
                }
            });
            
            if (!response.ok) {
                throw new Error('Failed to fetch users');
            }
            
            const data = await response.json();
            return data.record.users;
        }

        // Login user and load their data
        async function loginUser(user) {
            currentUser = user;
            
            // Save to localStorage for persistence
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            // Hide login page, show dashboard
            loginPage.style.display = 'none';
            dashboard.style.display = 'block';
            
            // Update UI with user info
            document.getElementById('user-name').textContent = user.username;
            document.getElementById('user-avatar').src = `https://via.placeholder.com/80/6b5ce7/ffffff?text=${user.username.charAt(0).toUpperCase()}`;
            
            // Load user data from their bin
            await loadUserData();
            
            // Initialize the dashboard
            updateProgressBars();
            renderSubjectCards();
            updateStudyTimeDisplays();
            loadComparisonData();
            initStudyChart();
        }

        // Load user data from their JSONBin
        async function loadUserData() {
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${currentUser.bin}/latest`, {
                    headers: {
                        'X-Access-Key': API_KEY
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch user data');
                }
                
                const data = await response.json();
                userData = data.record;
                
                // Initialize with default data if empty
                if (!userData.subjects) {
                    userData.subjects = {
                        chemistry: { chapters: [], completed: 0 },
                        physics: { chapters: [], completed: 0 },
                        maths: { chapters: [], completed: 0 }
                    };
                }
                
                if (!userData.studyTime) {
                    userData.studyTime = {
                        today: 0,
                        week: 0,
                        total: 0,
                        weeklyData: []
                    };
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                // Initialize with default data if fetch fails
                userData = {
                    subjects: {
                        chemistry: { chapters: [], completed: 0 },
                        physics: { chapters: [], completed: 0 },
                        maths: { chapters: [], completed: 0 }
                    },
                    studyTime: {
                        today: 0,
                        week: 0,
                        total: 0,
                        weeklyData: []
                    }
                };
            }
        }

        // Save user data to their JSONBin
        async function saveUserData() {
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${currentUser.bin}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Access-Key': API_KEY
                    },
                    body: JSON.stringify(userData)
                });
                
                if (!response.ok) {
                    throw new Error('Failed to save user data');
                }
                
                console.log('User data saved successfully');
            } catch (error) {
                console.error('Error saving user data:', error);
            }
        }

        // Handle logout
        function handleLogout() {
            // Clear timer
            if (studyTimer.interval) {
                clearInterval(studyTimer.interval);
            }
            
            // Reset user data
            currentUser = null;
            userData = null;
            
            // Clear localStorage
            localStorage.removeItem('currentUser');
            
            // Reset form fields
            usernameInput.value = '';
            passwordInput.value = '';
            
            // Show login page, hide dashboard
            loginPage.style.display = 'flex';
            dashboard.style.display = 'none';
        }

        // Show error message
        function showError(message) {
            loginError.textContent = message;
            loginError.style.display = 'block';
            
            // Hide error after 3 seconds
            setTimeout(() => {
                loginError.style.display = 'none';
            }, 3000);
        }

        // Update progress bars based on user data
        function updateProgressBars() {
            const subjects = userData.subjects;
            
            // Calculate progress percentages
            const chemProgress = subjects.chemistry.completed || 0;
            const physicsProgress = subjects.physics.completed || 0;
            const mathsProgress = subjects.maths.completed || 0;
            
            const overallProgress = Math.round((chemProgress + physicsProgress + mathsProgress) / 3);
            
            // Update progress bars
            document.getElementById('chemistry-progress').style.width = `${chemProgress}%`;
            document.getElementById('physics-progress').style.width = `${physicsProgress}%`;
            document.getElementById('maths-progress').style.width = `${mathsProgress}%`;
            document.getElementById('overall-progress').style.width = `${overallProgress}%`;
            
            // Update percentage labels
            document.getElementById('chemistry-percent').textContent = `${chemProgress}%`;
            document.getElementById('physics-percent').textContent = `${physicsProgress}%`;
            document.getElementById('maths-percent').textContent = `${mathsProgress}%`;
            document.getElementById('overall-percent').textContent = `${overallProgress}%`;
        }

        // Render subject cards
        function renderSubjectCards() {
            const subjects = userData.subjects;
            subjectsContainer.innerHTML = '';
            
            for (const [subject, data] of Object.entries(subjects)) {
                const subjectCard = document.createElement('div');
                subjectCard.className = `subject-card ${subject}`;
                
                subjectCard.innerHTML = `
                    <div class="subject-header">
                        <h4>${subject.charAt(0).toUpperCase() + subject.slice(1)}</h4>
                        <span>${data.completed || 0}% Complete</span>
                    </div>
                    <div class="subject-progress">
                        <div class="subject-progress-fill" style="width: ${data.completed || 0}%"></div>
                    </div>
                    <ul class="chapters-list" id="${subject}-chapters">
                        ${renderChapterList(subject, data.chapters || [])}
                    </ul>
                    <div class="add-chapter">
                        <input type="text" id="${subject}-new-chapter" placeholder="Add new chapter">
                        <button onclick="addChapter('${subject}')">Add</button>
                    </div>
                `;
                
                subjectsContainer.appendChild(subjectCard);
            }
            
            // Add event listeners to checkboxes
            setTimeout(() => {
                document.querySelectorAll('.chapter-item input[type="checkbox"]').forEach(checkbox => {
                    checkbox.addEventListener('change', handleChapterToggle);
                });
            }, 100);
        }

        // Render chapter list for a subject
        function renderChapterList(subject, chapters) {
            if (chapters.length === 0) {
                return `<li class="chapter-item">No chapters added yet</li>`;
            }
            
            return chapters.map((chapter, index) => `
                <li class="chapter-item">
                    <label for="${subject}-chapter-${index}">${chapter.name}</label>
                    <input type="checkbox" id="${subject}-chapter-${index}" 
                           data-subject="${subject}" data-index="${index}" 
                           ${chapter.completed ? 'checked' : ''}>
                </li>
            `).join('');
        }

        // Handle chapter toggle (mark as complete/incomplete)
        function handleChapterToggle(e) {
            const checkbox = e.target;
            const subject = checkbox.dataset.subject;
            const index = parseInt(checkbox.dataset.index);
            
            // Update chapter completion status
            userData.subjects[subject].chapters[index].completed = checkbox.checked;
            
            // Update subject completion percentage
            updateSubjectCompletion(subject);
            
            // Update UI
            updateProgressBars();
            
            // Save data
            saveUserData();
        }

        // Update subject completion percentage
        function updateSubjectCompletion(subject) {
            const chapters = userData.subjects[subject].chapters;
            if (chapters.length === 0) {
                userData.subjects[subject].completed = 0;
                return;
            }
            
            const completedChapters = chapters.filter(ch => ch.completed).length;
            const completionPercentage = Math.round((completedChapters / chapters.length) * 100);
            
            userData.subjects[subject].completed = completionPercentage;
        }

        // Add a new chapter to a subject
        function addChapter(subject) {
            const input = document.getElementById(`${subject}-new-chapter`);
            const chapterName = input.value.trim();
            
            if (!chapterName) return;
            
            // Add new chapter
            if (!userData.subjects[subject].chapters) {
                userData.subjects[subject].chapters = [];
            }
            
            userData.subjects[subject].chapters.push({
                name: chapterName,
                completed: false
            });
            
            // Update subject completion
            updateSubjectCompletion(subject);
            
            // Clear input
            input.value = '';
            
            // Update UI
            renderSubjectCards();
            updateProgressBars();
            
            // Save data
            saveUserData();
            
            // If this is a new chapter, add it to the other user's bin as well
            addChapterToOtherUsers(subject, chapterName);
        }

        // Add new chapter to all users
        async function addChapterToOtherUsers(subject, chapterName) {
            try {
                // Get all users
                const users = await fetchUsers();
                
                // For each user (excluding current user)
                for (const user of users) {
                    if (user.username !== currentUser.username) {
                        // Fetch user data
                        const response = await fetch(`https://api.jsonbin.io/v3/b/${user.bin}/latest`, {
                            headers: {
                                'X-Access-Key': API_KEY
                            }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            const userData = data.record;
                            
                            // Initialize subjects if not exists
                            if (!userData.subjects) {
                                userData.subjects = {
                                    chemistry: { chapters: [], completed: 0 },
                                    physics: { chapters: [], completed: 0 },
                                    maths: { chapters: [], completed: 0 }
                                };
                            }
                            
                            // Add chapter if it doesn't exist
                            if (!userData.subjects[subject].chapters) {
                                userData.subjects[subject].chapters = [];
                            }
                            
                            const chapterExists = userData.subjects[subject].chapters.some(ch => ch.name === chapterName);
                            if (!chapterExists) {
                                userData.subjects[subject].chapters.push({
                                    name: chapterName,
                                    completed: false
                                });
                                
                                // Save updated data
                                await fetch(`https://api.jsonbin.io/v3/b/${user.bin}`, {
                                    method: 'PUT',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'X-Access-Key': API_KEY
                                    },
                                    body: JSON.stringify(userData)
                                });
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('Error adding chapter to other users:', error);
            }
        }

        // Timer functions
        function startTimer() {
            if (!studyTimer.isRunning) {
                studyTimer.startTime = new Date();
                studyTimer.isRunning = true;
                
                studyTimer.interval = setInterval(updateTimer, 1000);
                
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                resetBtn.disabled = false;
            }
        }

        function pauseTimer() {
            if (studyTimer.isRunning) {
                studyTimer.elapsed += Math.floor((new Date() - studyTimer.startTime) / 1000);
                clearInterval(studyTimer.interval);
                studyTimer.isRunning = false;
                
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                
                // Save study time
                updateStudyTime(studyTimer.elapsed);
                studyTimer.elapsed = 0;
            }
        }

        function resetTimer() {
            clearInterval(studyTimer.interval);
            studyTimer = {
                startTime: null,
                elapsed: 0,
                isRunning: false,
                interval: null
            };
            
            timerDisplay.textContent = '00:00:00';
            
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            resetBtn.disabled = true;
        }

        function updateTimer() {
            const elapsedSeconds = studyTimer.elapsed + Math.floor((new Date() - studyTimer.startTime) / 1000);
            
            const hours = Math.floor(elapsedSeconds / 3600);
            const minutes = Math.floor((elapsedSeconds % 3600) / 60);
            const seconds = elapsedSeconds % 60;
            
            timerDisplay.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Update study time in user data
        function updateStudyTime(seconds) {
            const hours = seconds / 3600;
            
            userData.studyTime.today += hours;
            userData.studyTime.week += hours;
            userData.studyTime.total += hours;
            
            // Update weekly data
            const today = new Date();
            const year = today.getFullYear();
            const week = getWeekNumber(today);
            
            let weekData = userData.studyTime.weeklyData.find(w => w.year === year && w.week === week);
            
            if (weekData) {
                weekData.hours += hours;
            } else {
                userData.studyTime.weeklyData.push({
                    year: year,
                    week: week,
                    hours: hours
                });
            }
            
            // Update UI
            updateStudyTimeDisplays();
            
            // Save data
            saveUserData();
            
            // Update chart
            updateStudyChart();
        }

        // Update study time displays
        function updateStudyTimeDisplays() {
            const todayHours = Math.floor(userData.studyTime.today);
            const todayMins = Math.round((userData.studyTime.today - todayHours) * 60);
            
            const weekHours = Math.floor(userData.studyTime.week);
            const weekMins = Math.round((userData.studyTime.week - weekHours) * 60);
            
            const totalHours = Math.floor(userData.studyTime.total);
            const totalMins = Math.round((userData.studyTime.total - totalHours) * 60);
            
            todayTime.textContent = `${todayHours}h ${todayMins}m`;
            weekTime.textContent = `${weekHours}h ${weekMins}m`;
            totalTime.textContent = `${totalHours}h ${totalMins}m`;
        }

        // Get week number for a date
        function getWeekNumber(date) {
            const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
            const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
            return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
        }

        // Initialize study chart
        function initStudyChart() {
            const ctx = document.getElementById('study-chart').getContext('2d');
            
            studyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Study Hours',
                        data: [0, 0, 0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(107, 92, 231, 0.7)',
                        borderColor: 'rgba(107, 92, 231, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#ddd'
                            },
                            grid: {
                                color: '#333'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#ddd'
                            },
                            grid: {
                                color: '#333'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ddd'
                            }
                        }
                    }
                }
            });
            
            updateStudyChart();
        }

        // Update study chart with current data
        function updateStudyChart() {
            // For demo purposes, generate random data
            // In a real app, you would use the actual study data
            const data = Array.from({length: 7}, () => Math.floor(Math.random() * 8));
            
            if (studyChart) {
                studyChart.data.datasets[0].data = data;
                studyChart.update();
            }
        }

        // Change week for study chart
        function changeWeek(offset) {
            currentWeekOffset += offset;
            
            // Update week display
            const today = new Date();
            const targetWeek = new Date(today.getTime() + (currentWeekOffset * 7 * 24 * 60 * 60 * 1000));
            const weekNumber = getWeekNumber(targetWeek);
            
            weekDisplay.textContent = `Week ${weekNumber}, ${targetWeek.toLocaleString('default', { month: 'short' })} ${targetWeek.getFullYear()}`;
            
            // Update chart with data for the selected week
            updateStudyChart();
        }

        // Load comparison data for other users
        async function loadComparisonData() {
            try {
                const users = await fetchUsers();
                
                for (let i = 0; i < Math.min(2, users.length); i++) {
                    const user = users[i];
                    
                    if (user.username !== currentUser.username) {
                        // Fetch user data
                        const response = await fetch(`https://api.jsonbin.io/v3/b/${user.bin}/latest`, {
                            headers: {
                                'X-Access-Key': API_KEY
                            }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            const userData = data.record;
                            
                            // Update comparison UI
                            document.getElementById(`comparison-progress-${i+1}`).style.width = 
                                `${Math.round((userData.subjects.chemistry.completed + userData.subjects.physics.completed + userData.subjects.maths.completed) / 3)}%`;
                            document.getElementById(`comparison-percent-${i+1}`).textContent = 
                                `${Math.round((userData.subjects.chemistry.completed + userData.subjects.physics.completed + userData.subjects.maths.completed) / 3)}%`;
                            
                            document.getElementById(`comparison-chemistry-${i+1}`).textContent = `${userData.subjects.chemistry.completed}%`;
                            document.getElementById(`comparison-chemistry-bar-${i+1}`).style.width = `${userData.subjects.chemistry.completed}%`;
                            
                            document.getElementById(`comparison-physics-${i+1}`).textContent = `${userData.subjects.physics.completed}%`;
                            document.getElementById(`comparison-physics-bar-${i+1}`).style.width = `${userData.subjects.physics.completed}%`;
                            
                            document.getElementById(`comparison-maths-${i+1}`).textContent = `${userData.subjects.maths.completed}%`;
                            document.getElementById(`comparison-maths-bar-${i+1}`).style.width = `${userData.subjects.maths.completed}%`;
                            
                            // Update avatar
                            document.querySelectorAll('.comparison-user-dp img')[i].src = 
                                `https://via.placeholder.com/60/6b5ce7/ffffff?text=${user.username.charAt(0).toUpperCase()}`;
                        }
                    }
                }
            } catch (error) {
                console.error('Error loading comparison data:', error);
            }
        }

        // Initialize the app when the DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
